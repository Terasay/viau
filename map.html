<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Галерея карт</title>
    <link rel="stylesheet" href="css/map.css">
    <link rel="stylesheet" href="/css/notifications.css">
    <script src="/js/notifications.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div id="galleryScreen">
        <div id="galleryHeader">
            <div class="header-left">
                <i class="fas fa-map-marked-alt header-icon"></i>
                <h1>Галерея карт</h1>
            </div>
            <div class="header-right">
                <button id="uploadMapBtn" class="btn-primary" style="display:none;">
                    <i class="fas fa-cloud-upload-alt"></i>
                    Загрузить карту
                </button>
                <button id="backToMainBtn" class="btn-secondary">
                    <i class="fas fa-home"></i>
                    Назад
                </button>
            </div>
        </div>
        
        <div id="mapGallery">
            <div id="loadingMaps">
                <div class="spinner"></div>
                <p>Загрузка карт...</p>
            </div>
        </div>
    </div>

    <div id="viewerScreen" style="display:none;">
        <div id="controls">
            <button onclick="closeViewer()" class="btn-back">
                <i class="fas fa-arrow-left"></i>
                К галерее
            </button>
            
            <div class="controls-divider"></div>
            
            <button onclick="zoomInButton()" class="btn-icon" title="Приблизить">
                <i class="fas fa-search-plus"></i>
            </button>
            <button onclick="zoomOutButton()" class="btn-icon" title="Отдалить">
                <i class="fas fa-search-minus"></i>
            </button>
            <button onclick="fitToScreen()" class="btn-icon" title="Вписать в экран">
                <i class="fas fa-expand"></i>
            </button>
            <button onclick="toggleSettings()" class="btn-icon" title="Настройки">
                <i class="fas fa-cog"></i>
            </button>
            
            <div class="controls-divider"></div>
            
            <div class="input-group">
                <label>Zoom:</label>
                <input type="number" id="zoomInput" min="0.05" max="100" step="0.01" value="1.00">
            </div>
            
            <div class="input-group">
                <label>Уровень:</label>
                <select id="quadLevelSelect">
                    <option value="auto">Авто</option>
                    <option value="0">Буквы</option>
                    <option value="1">A1-A9</option>
                    <option value="2">A11-A99</option>
                    <option value="3">A111-A999</option>
                    <option value="4">A1111-A9999</option>
                </select>
            </div>
            
            <div id="zoomInfo">
                <i class="fas fa-info-circle"></i>
                <span>Zoom: 1.00x | Level: 0</span>
            </div>
        </div>
        <canvas id="canvas"></canvas>
    </div>

    <div id="uploadModal" class="modal" style="display:none;">
        <div class="modal-overlay" onclick="closeUploadModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-cloud-upload-alt"></i> Загрузить новую карту</h2>
                <button class="modal-close" onclick="closeUploadModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="input-field">
                    <label for="mapNameInput">
                        <i class="fas fa-tag"></i> Название карты
                    </label>
                    <input type="text" id="mapNameInput" placeholder="Введите название..." maxlength="100">
                </div>
                <div class="input-field">
                    <label for="mapFileInput">
                        <i class="fas fa-image"></i> Файл изображения
                    </label>
                    <div class="file-input-wrapper">
                        <input type="file" id="mapFileInput" accept="image/*">
                        <div class="file-input-display">
                            <i class="fas fa-file-image"></i>
                            <span>Выберите файл...</span>
                        </div>
                    </div>
                </div>
                <div id="filePreview" class="file-preview" style="display: none;"></div>
            </div>
            <div class="modal-footer">
                <button onclick="submitUploadMap()" class="btn-primary">
                    <i class="fas fa-check"></i>
                    Загрузить
                </button>
                <button onclick="closeUploadModal()" class="btn-secondary">
                    <i class="fas fa-times"></i>
                    Отмена
                </button>
            </div>
            <div id="uploadStatus"></div>
        </div>
    </div>

    <div id="editModal" class="modal" style="display:none;">
        <div class="modal-overlay" onclick="closeEditModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Редактировать карту</h2>
                <button class="modal-close" onclick="closeEditModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="input-field">
                    <label for="editMapNameInput">
                        <i class="fas fa-tag"></i> Название карты
                    </label>
                    <input type="text" id="editMapNameInput" placeholder="Введите название..." maxlength="100">
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="submitEditMap()" class="btn-primary">
                    <i class="fas fa-save"></i>
                    Сохранить
                </button>
                <button onclick="closeEditModal()" class="btn-secondary">
                    <i class="fas fa-times"></i>
                    Отмена
                </button>
            </div>
        </div>
    </div>

    <div id="settingsPanel" class="settings-panel" style="display: none;">
        <div class="settings-header">
            <h3><i class="fas fa-cog"></i> Настройки сетки</h3>
            <button onclick="toggleSettings()" class="settings-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="settings-body">
            <div class="setting-item">
                <div class="setting-label">
                    <i class="fas fa-eye"></i>
                    <span>Показывать сетку</span>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggleGrid" checked onchange="updateGridVisibility()">
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <div class="settings-divider"></div>

            <div class="setting-item">
                <div class="setting-label">
                    <i class="fas fa-palette"></i>
                    <span>Цвет основной сетки (A, B, C...)</span>
                </div>
                <input type="color" id="mainGridColor" value="#e74c3c" onchange="updateGridColors()">
            </div>

            <div class="setting-item">
                <div class="setting-label">
                    <i class="fas fa-palette"></i>
                    <span>Цвет сетки уровня 1 (A1-A9)</span>
                </div>
                <input type="color" id="level1Color" value="#3498db" onchange="updateGridColors()">
            </div>

            <div class="setting-item">
                <div class="setting-label">
                    <i class="fas fa-palette"></i>
                    <span>Цвет сетки уровня 2 (A11-A99)</span>
                </div>
                <input type="color" id="level2Color" value="#2ecc71" onchange="updateGridColors()">
            </div>

            <div class="setting-item">
                <div class="setting-label">
                    <i class="fas fa-palette"></i>
                    <span>Цвет сетки уровня 3 (A111-A999)</span>
                </div>
                <input type="color" id="level3Color" value="#9b59b6" onchange="updateGridColors()">
            </div>

            <div class="setting-item">
                <div class="setting-label">
                    <i class="fas fa-palette"></i>
                    <span>Цвет сетки уровня 4 (A1111+)</span>
                </div>
                <input type="color" id="level4Color" value="#e67e22" onchange="updateGridColors()">
            </div>

            <div class="settings-divider"></div>

            <div class="setting-item">
                <div class="setting-label">
                    <i class="fas fa-ruler"></i>
                    <span>Толщина основных линий</span>
                    <span class="setting-value" id="mainLineWidthValue">2px</span>
                </div>
                <input type="range" id="mainLineWidth" min="1" max="5" value="2" step="0.5" oninput="updateLineWidth('main', this.value)">
            </div>

            <div class="setting-item">
                <div class="setting-label">
                    <i class="fas fa-ruler"></i>
                    <span>Толщина вложенных линий</span>
                    <span class="setting-value" id="subLineWidthValue">1px</span>
                </div>
                <input type="range" id="subLineWidth" min="0.5" max="3" value="1" step="0.25" oninput="updateLineWidth('sub', this.value)">
            </div>

            <div class="settings-divider"></div>

            <button onclick="resetSettings()" class="btn-reset">
                <i class="fas fa-undo"></i>
                Сбросить настройки
            </button>
        </div>
    </div>

    <script src="js/map.js"></script>
</body>
</html>